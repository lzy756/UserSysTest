<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>顾客列表</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- 页面标题和操作 -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3">
                <i class="fas fa-users me-2"></i>顾客列表
                <small class="text-muted">（共 <span th:text="${customerPage.totalElements}">0</span> 条记录）</small>
            </h1>
            <a th:href="@{/customers/new}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>添加顾客
            </a>
        </div>

        <!-- 搜索过滤器 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-search me-2"></i>搜索过滤
                </h5>
            </div>
            <div class="card-body">
                <form th:action="@{/customers}" method="get" class="row g-3">
                    <div class="col-md-3">
                        <label for="name" class="form-label">姓名</label>
                        <input type="text" class="form-control" id="name" name="name"
                               th:value="${searchName}" placeholder="输入姓名...">
                    </div>
                    <div class="col-md-3">
                        <label for="phone" class="form-label">手机号</label>
                        <input type="text" class="form-control" id="phone" name="phone"
                               th:value="${searchPhone}" placeholder="输入手机号...">
                    </div>
                    <div class="col-md-3">
                        <label for="email" class="form-label">邮箱</label>
                        <input type="email" class="form-control" id="email" name="email"
                               th:value="${searchEmail}" placeholder="输入邮箱...">
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-outline-primary me-2">
                            <i class="fas fa-search me-1"></i>搜索
                        </button>
                        <a th:href="@{/customers}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-1"></i>清除
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- 顾客表格 -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">顾客信息</h5>
                <div class="text-muted">
                    显示第 <span th:text="${customerPage.pageable.pageNumber * customerPage.pageable.pageSize + 1}">1</span>
                    到 <span th:text="${customerPage.pageable.pageNumber * customerPage.pageable.pageSize + customerPage.numberOfElements}">10</span>
                    条，共 <span th:text="${customerPage.totalElements}">0</span> 条记录
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>
                                    <a th:href="@{/customers(page=${currentPage}, size=${pageSize}, sortBy='id', sortDir=${sortBy == 'id' ? reverseSortDir : 'asc'}, name=${searchName}, phone=${searchPhone}, email=${searchEmail})}"
                                       class="text-decoration-none">
                                        ID
                                        <i th:if="${sortBy == 'id'}"
                                           th:class="${sortDir == 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down'}"></i>
                                    </a>
                                </th>
                                <th>
                                    <a th:href="@{/customers(page=${currentPage}, size=${pageSize}, sortBy='name', sortDir=${sortBy == 'name' ? reverseSortDir : 'asc'}, name=${searchName}, phone=${searchPhone}, email=${searchEmail})}"
                                       class="text-decoration-none">
                                        姓名
                                        <i th:if="${sortBy == 'name'}"
                                           th:class="${sortDir == 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down'}"></i>
                                    </a>
                                </th>
                                <th>手机号</th>
                                <th>邮箱</th>
                                <th>年龄</th>
                                <th>性别</th>
                                <th>地址</th>
                                <th>创建时间</th>
                                <th width="150">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="customer : ${customerPage.content}">
                                <td th:text="${customer.id}">1</td>
                                <td>
                                    <a th:href="@{/customers/{id}(id=${customer.id})}"
                                       class="text-decoration-none fw-bold"
                                       th:text="${customer.name}">张三</a>
                                </td>
                                <td th:text="${customer.phone}">13800138001</td>
                                <td th:text="${customer.email}">email@example.com</td>
                                <td th:text="${customer.age}">25</td>
                                <td>
                                    <span th:if="${customer.gender == T(com.example.customer.entity.Customer.Gender).MALE}"
                                          class="badge bg-primary">男</span>
                                    <span th:if="${customer.gender == T(com.example.customer.entity.Customer.Gender).FEMALE}"
                                          class="badge bg-danger">女</span>
                                    <span th:if="${customer.gender == T(com.example.customer.entity.Customer.Gender).OTHER}"
                                          class="badge bg-secondary">其他</span>
                                </td>
                                <td th:text="${#strings.abbreviate(customer.address, 20)}">地址</td>
                                <td th:text="${#temporals.format(customer.createdTime, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a th:href="@{/customers/{id}(id=${customer.id})}"
                                           class="btn btn-outline-info" title="查看详情">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a th:href="@{/customers/{id}/edit(id=${customer.id})}"
                                           class="btn btn-outline-primary" title="编辑">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <button type="button" class="btn btn-outline-danger"
                                                title="删除"
                                                onclick="confirmDelete([[${customer.id}]], '[[${customer.name}]]')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${customerPage.content.empty}">
                                <td colspan="9" class="text-center py-4 text-muted">
                                    <i class="fas fa-inbox fa-2x mb-2"></i><br>
                                    暂无顾客信息
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 分页 -->
            <div class="card-footer" th:if="${customerPage.totalPages > 1}">
                <nav aria-label="分页导航">
                    <ul class="pagination pagination-sm mb-0 justify-content-center">
                        <!-- 上一页 -->
                        <li class="page-item" th:classappend="${customerPage.first} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/customers(page=${customerPage.number - 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, name=${searchName}, phone=${searchPhone}, email=${searchEmail})}">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>

                        <!-- 页码 -->
                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(T(java.lang.Math).max(0, customerPage.number - 2), T(java.lang.Math).min(customerPage.totalPages - 1, customerPage.number + 2))}"
                            th:classappend="${i == customerPage.number} ? 'active'">
                            <a class="page-link"
                               th:href="@{/customers(page=${i}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, name=${searchName}, phone=${searchPhone}, email=${searchEmail})}"
                               th:text="${i + 1}">1</a>
                        </li>

                        <!-- 下一页 -->
                        <li class="page-item" th:classappend="${customerPage.last} ? 'disabled'">
                            <a class="page-link"
                               th:href="@{/customers(page=${customerPage.number + 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, name=${searchName}, phone=${searchPhone}, email=${searchEmail})}">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- 删除确认模态框 -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>确认删除
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>您确定要删除顾客 "<span id="customerName"></span>" 吗？</p>
                        <p class="text-muted">此操作不可撤销。</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <form id="deleteForm" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash me-1"></i>删除
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="scripts">
        <script>
            function confirmDelete(customerId, customerName) {
                document.getElementById('customerName').textContent = customerName;
                document.getElementById('deleteForm').action = '/customers/' + customerId + '/delete';
                new bootstrap.Modal(document.getElementById('deleteModal')).show();
            }
        </script>
    </th:block>
</body>
</html>